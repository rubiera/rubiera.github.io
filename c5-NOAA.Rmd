---
title: "NOAA Storm Data Analysis"
author: "Antonio Rubiera"
date: "9/30/2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Sypnosis

We analyze the storm data available from NOAA for the years 1950-2011. The data as loaded requires filtering for columns we will not use and several transformations. In our first transformation, we select the year for each observation out of a string, and later perform an inflation adjustment for the financial costs by year using the website [https://www.usinflationcalculator.com/]. We perform transformations into new columns that capture the sum of fatalities and injuries, and the sum of financial damage to property and crops. To get to the sum of financial damage to property and crops, we fist change the exponent for property (PROPDMGEXP) and crop (CROPDMGEXP) damage from a letter, any other character, or blank to a number. We use this number as the product to multiply the respective base (PROPDMG, CROPDMG) costs by. . We perform an outlier analysis of the fatalities and the sum of financial damage to property and crops, and make corrections to the data for the latter. We recode the event type (EVTYPE) to eight categories from hundreds of descriptions found in the data. Finally, we sum the data for each year and each category and plot the result for fatalities and injuries, and the sum of financial damage to property and crops. 

## Data Processing

We use the following R libraries.

```{r libraries, warning = FALSE, message=FALSE}
library(data.table)
library(R.utils)
library(tidyverse)
library(ggplot2)
library(knitr)
```

### Data load.

We use data.table's fread to load the data. This dataset has 902,247 observations in 37 columns. 

```{r data load, cache = TRUE}
StormDataDT <- fread("./data/repdata_data_StormData.csv.bz2")
head(StormDataDT)
```

### Filtering data into a working dataset.

We filter columns we need for our analysis.

```{r filter, cache = TRUE}
StormDataDT_recode <- StormDataDT[,
    c("REFNUM","BGN_DATE","EVTYPE","FATALITIES","INJURIES", 
      "PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP")]
head(StormDataDT_recode)
tail(StormDataDT_recode)
str(StormDataDT_recode)
```

### Year recode

We recode the year out of the BGN_DATE field. We select that column out to strip out the year. 

```{r BGN_DATE_year, cache = TRUE}
BGN_DATE_year <- as.character(StormDataDT_recode$BGN_DATE)

for (i in 1:length(BGN_DATE_year)){
  BGN_DATE_year[i] <- 
    unlist(substring(strsplit(BGN_DATE_year[[i]], "/")[[1]][[3]],1,4))
}

head(BGN_DATE_year)
tail(BGN_DATE_year)
length(BGN_DATE_year)
```

We bind the stripped year back into the dataset, and check that we still have a data.table data frame.

```{r BGN_DATE in, cache = TRUE}
StormDataDT_recode <- cbind(StormDataDT_recode,BGN_DATE_year)
head(StormDataDT_recode)
class(StormDataDT_recode)
```

### PROPDMGEXP recode.

We take a look at the characters found in the property damage exponent (PROPDMGEXP) column.

```{r PROPDMGEXP recode step 1, cache = TRUE}
recode_PROPDMGEXP <- StormDataDT_recode[,PROPDMGEXP]
class(recode_PROPDMGEXP)
table(recode_PROPDMGEXP)
```

We recode these values and check the result.

```{r PROPDMGEXP recode step 2, cache = TRUE}
for (i in seq_along(recode_PROPDMGEXP)){

  if(recode_PROPDMGEXP[[i]] == "1"){
    recode_PROPDMGEXP[[i]] <- 10
  }
    
  if(recode_PROPDMGEXP[[i]] == "" | 
     recode_PROPDMGEXP[[i]] == "0" |
     recode_PROPDMGEXP[[i]] == "-" |
     recode_PROPDMGEXP[[i]] == "?" |
     recode_PROPDMGEXP[[i]] == "+" |
     recode_PROPDMGEXP[[i]] == "h" |
     recode_PROPDMGEXP[[i]] == "H"){
    recode_PROPDMGEXP[[i]] <- 1
  }

  if(recode_PROPDMGEXP[[i]] == "2"){
    recode_PROPDMGEXP[[i]] <- 100
  }
  if(recode_PROPDMGEXP[[i]] == "k" | 
     recode_PROPDMGEXP[[i]] == "K" |
     recode_PROPDMGEXP[[i]] == "3"){
    recode_PROPDMGEXP[[i]] <- 1000
  }
  if(recode_PROPDMGEXP[[i]] == "4"){
    recode_PROPDMGEXP[[i]] <- 10000
  }
  if(recode_PROPDMGEXP[[i]] == "5"){
    recode_PROPDMGEXP[[i]] <- 100000
  }
  if(recode_PROPDMGEXP[[i]] == "m" | 
     recode_PROPDMGEXP[[i]] == "M" |
     recode_PROPDMGEXP[[i]] == "6"){
    recode_PROPDMGEXP[[i]] <- 1000000
  }
  if(recode_PROPDMGEXP[[i]] == "7"){
    recode_PROPDMGEXP[[i]] <- 10000000
  }
  if(recode_PROPDMGEXP[[i]] == "8"){
    recode_PROPDMGEXP[[i]] <- 100000000
  }
  if(recode_PROPDMGEXP[[i]] == "B"){
    recode_PROPDMGEXP[[i]] <- 1000000000
  }
  
}

table(recode_PROPDMGEXP)

```

### CROPDMGEXP recode.

We take a look at the characters found in the crop damage exponent (CROPDMGEXP) column.

```{r CROPDMGEXP recode step 1, cache = TRUE}
recode_CROPDMGEXP <- StormDataDT_recode[,CROPDMGEXP]
class(recode_CROPDMGEXP)
table(recode_CROPDMGEXP)
```

We recode these values and check the result.

```{r CROPDMGEXP recode step 2, cache = TRUE}
for (i in seq_along(recode_CROPDMGEXP)){
  
  if(recode_CROPDMGEXP[[i]] == "" | 
     recode_CROPDMGEXP[[i]] == "0" |
     recode_CROPDMGEXP[[i]] == "?" ){
    recode_CROPDMGEXP[[i]] <- 1
  }
  
  if(recode_CROPDMGEXP[[i]] == "2"){
    recode_CROPDMGEXP[[i]] <- 100
  }
  if(recode_CROPDMGEXP[[i]] == "k" | 
     recode_CROPDMGEXP[[i]] == "K" ){
    recode_CROPDMGEXP[[i]] <- 1000
  }

  if(recode_CROPDMGEXP[[i]] == "m" | 
     recode_CROPDMGEXP[[i]] == "M" ){
    recode_CROPDMGEXP[[i]] <- 1000000
  }

  if(recode_CROPDMGEXP[[i]] == "B"){
    recode_CROPDMGEXP[[i]] <- 1000000000
  }
  
}

table(recode_CROPDMGEXP)
```

### PROPDMGEXP and CROPDMGEXP recodes incorporated into our dataset.

We bind the recoded columns into our working dataset (StormDataDT_recode). We test that we still have a data.table data frame and that our sums for numerical columns are indeed numerical.

```{r PROPDMGEXP CROPDMGEXP recode, cache = TRUE}
StormDataDT_recode <- cbind(StormDataDT_recode,recode_PROPDMGEXP,recode_CROPDMGEXP)
head(StormDataDT_recode)
class(StormDataDT_recode)
sum(StormDataDT_recode$PROPDMG)
sum(StormDataDT_recode$CROPDMG)
```

We take the products from our records and come up with a sum of the total property and crop damage by individual event (REFNUM), and sum fatalities and injuries into an additional column.

```{r sums main step, cache = TRUE}
StormDataDT_recode_totals <- StormDataDT_recode[,
                             PROPDMG.Total := PROPDMG*as.numeric(recode_PROPDMGEXP)]
head(StormDataDT_recode_totals)
StormDataDT_recode_totals <- StormDataDT_recode[,
                             CROPDMG.Total := CROPDMG*as.numeric(recode_CROPDMGEXP)]
head(StormDataDT_recode_totals)
StormDataDT_recode_totals <- StormDataDT_recode[,
                             Fatalities.and.Injuries := FATALITIES + INJURIES]
head(StormDataDT_recode_totals)
StormDataDT_recode_totals <- StormDataDT_recode[,
                             Property.and.Crop.Damage := PROPDMG.Total + CROPDMG.Total]
head(StormDataDT_recode_totals)
```

### Outlier Analysis for property and crop damage.

We add up totals for the analysis before we perform the outlier analysis and recodes from it.

```{r totals early check, cache = TRUE}
sum(StormDataDT_recode_totals$FATALITIES)
sum(StormDataDT_recode_totals$INJURIES)
sum(StormDataDT_recode_totals$Fatalities.and.Injuries)
sum(StormDataDT_recode_totals$PROPDMG.Total)
sum(StormDataDT_recode_totals$CROPDMG.Total)
sum(StormDataDT_recode_totals$Property.and.Crop.Damage)
```

We select the top financial cost events to make sure the values make sense. 

```{r outlier money REFNUM load, cache = TRUE}
StormDataDT_recode_large <- StormDataDT_recode_totals[Property.and.Crop.Damage >= 1000000000]
StormDataDT_recode_large$REFNUM
```

We check each one and come up with a disposition for accepting all of the values, or which values I need to change. We only show here the ones for which we made changes to the data. We also show the narrative for Katrina because these are some of the largest costs in this analysis.

Disposition: needs changes.

--75 million and not $5 billion
--Property.and.Crop.Damage 50000000
--PROPDMG 75 PROPDMGEXP M recode_PROPDMGEXP 1000000 PROPDMG.Total 75000000
Most of the damage estimates were at least $50 million.  
Some estimates ranged between $80 and $100 million

```{r outlier money REFNUM 1, cache = TRUE}
StormDataDT[REFNUM == 187564,REMARKS]
StormDataDT_recode_large[REFNUM == 187564,
                      c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                        "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                        "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Disposition: needs changes.
"Twenty five percent of the states pecan crop will be lost for the next five to ten years at an estimated cost of $5.5 million per year"

--CROPDMG 55 CROPDMGEXP M recode_CROPDMGEXP 1000000 CROPDMG.Total 55000000
--Property.and.Crop.Damage 55500000


```{r outlier money REFNUM 7, cache = TRUE}
StormDataDT[REFNUM == 211887,REMARKS]
StormDataDT_recode_large[REFNUM == 211887,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Disposition: seems an over-estimate.

PROPDMG 100 PROPDMGEXP M recode_PROPDMGEXP 100000000 Property.and.Crop.Damage 100000000

```{r outlier money REFNUM 14, cache = TRUE}
StormDataDT[REFNUM == 485535,REMARKS]
StormDataDT_recode_large[REFNUM == 485535,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Big outlier mistake: "The City of Napa had 600 homes with moderate damage, 150 damaged businesses with costs of at least $70 million."

--PROPDMG OK PROPDMGEXP M and not B (BIG DIFFERENCE)
--recode_PROPDMGEXP 1000000
--PROPDMG.Total 115000000
--Property.and.Crop.Damage (115+32.5)= 147500000 

```{r outlier money REFNUM 32, cache = TRUE}
StormDataDT[REFNUM == 605943,REMARKS]
StormDataDT_recode_large[REFNUM == 605943,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

The second big error in the data

"The damages of 200 thousand dollars covered both the roof damage as well as money to replace the ruined food"
--PROPDMG 200 PROPDMGEXP K recode_PROPDMGEXP 1000
--PROPDMG.Total 200000 Property.and.Crop.Damage 200000

```{r outlier money REFNUM 37, cache = TRUE}
StormDataDT[REFNUM == 834634,REMARKS]
StormDataDT_recode_large[REFNUM == 834634,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Disposition: seems like an over estimate.

--PROPDMG 150 PROPDMGEXP M recode_PROPDMGEXP 1000000 
--PROPDMG.Total 150000000 Property.and.Crop.Damage 150000000

```{r outlier money REFNUM 39, cache = TRUE}
StormDataDT[REFNUM == 860355,REMARKS]
StormDataDT_recode_large[REFNUM == 860355,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Disposition: seems like an over estimate.
"The area known as Tunica Cut-Off was flooded as many as 357 homes sustained damage."

--PROPDMG 100 PROPDMGEXP M recode_PROPDMGEXP 1000000 
--PROPDMG.Total 100000000    Property.and.Crop.Damage 100000000

```{r outlier money REFNUM 41, cache = TRUE}
StormDataDT[REFNUM == 867679,REMARKS]
StormDataDT_recode_large[REFNUM == 867679,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

Disposition: seems like an over estimate

--PROPDMG 200 PROPDMGEXP M recode_PROPDMGEXP 1000000 
--PROPDMG.Total 200000000 #Property.and.Crop.Damage 200000000

```{r outlier money REFNUM 42, cache = TRUE}
StormDataDT[REFNUM == 867996,REMARKS]
StormDataDT_recode_large[REFNUM == 867996,
                         c("PROPDMG","PROPDMGEXP","CROPDMG","CROPDMGEXP",
                           "recode_PROPDMGEXP", "recode_CROPDMGEXP", 
                           "PROPDMG.Total","CROPDMG.Total","Property.and.Crop.Damage")]
```

### Outlier analysis for fatalities and injuries

We found the fatalities and injuries data to be accurate throughout, and did not change any of the values in the data. Here are the cases for 100 or more fatalities. 

```{r outlier money REFNUM 43, cache = TRUE}
#####################life cost outlier analysis
StormDataDT_recode_life <- StormDataDT_recode_totals[FATALITIES >= 100]
StormDataDT_recode_life$REFNUM
```

### EVTYPE recode.

For REFNUM 215144 we had to change EVTYPE to "WINTER WEATHER" because the original data contained a "\" character, which causes an error when we run in Windows. 

```{r outlier money REFNUM 48, cache = TRUE}
StormDataDT[REFNUM == 215144, EVTYPE]
```

### Outlier Analysis Code.

This is the code in which we implement our outlier analysis.

```{r outlier implementation, cache = TRUE}
for (i in 1:nrow(StormDataDT_recode_totals)) {
  
    if(StormDataDT_recode_totals$REFNUM[[i]] == 187564)
    {
      #disposition
      #CROPDMG 55 CROPDMGEXP M recode_CROPDMGEXP 1000000 CROPDMG.Total 55000000
      #Property.and.Crop.Damage 55500000
      print("REFNUM == 187564")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 75
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  75000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 75000000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 187564),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    
    if(StormDataDT_recode_totals$REFNUM[[i]] == 211887)
    {
      #disposition
      #CROPDMG 55 CROPDMGEXP M recode_CROPDMGEXP 1000000 CROPDMG.Total 55000000
      #Property.and.Crop.Damage 55500000
      print("REFNUM == 211887")
      print(i)
      StormDataDT_recode_totals$CROPDMG[[i]] <- 55
      StormDataDT_recode_totals$CROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_CROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$CROPDMG.Total[[i]] <-  55000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 55500000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 211887),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
  
      ###special recode
      ###for \
      if(StormDataDT_recode_totals$REFNUM[[i]] == 215144)
      {
        #disposition
        #StormDataDT[REFNUM == ,EVTYPE] <- "WINTER WEATHER"
        #EVTYPE <- "WINTER WEATHER"
        #Property.and.Crop.Damage 55500000
        print("REFNUM == 215144")
        print("Special EV_TYPE recode")
        print(i)
        StormDataDT_recode_totals$EVTYPE[[i]] <- "WINTER WEATHER"
        print(select(filter(StormDataDT_recode_totals,REFNUM == 215144),
                     PROPDMG.Total:Property.and.Crop.Damage))
      }
  
    if(StormDataDT_recode_totals$REFNUM[[i]] == 485535)
    {
      #disposition
      #seems an over-estimate
      #PROPDMG 100 PROPDMGEXP M 
      #recode_PROPDMGEXP 1000000 Property.and.Crop.Damage 100000000
      print("REFNUM == 485535")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 100
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  100000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 100000000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 485535),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    if(StormDataDT_recode_totals$REFNUM[[i]] == 605943)
    {
      #disposition
      #big outlier mistake
      #PROPDMG OK PROPDMGEXP M and not B (BIG DIFFERENCE)
      #recode_PROPDMGEXP 1000000
      #PROPDMG.Total 115000000
      #Property.and.Crop.Damage (115+32.5)= 147500000 
      print("REFNUM == 605943")
      print(i)
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  115000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 147500000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 605943),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    if(StormDataDT_recode_totals$REFNUM[[i]] == 834634)
    {
      #disposition
      #PROPDMG 200 PROPDMGEXP K recode_PROPDMGEXP 1000
      # PROPDMG.Total 200000 Property.and.Crop.Damage 200000
      print("REFNUM == 834634")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 200
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "K"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  200000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 200000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 834634),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    if(StormDataDT_recode_totals$REFNUM[[i]] == 860355)
    {
      #disposition
      #PROPDMG 150 PROPDMGEXP M recode_PROPDMGEXP 1000000 
      #PROPDMG.Total 150000000 Property.and.Crop.Damage 150000000
      print("REFNUM == 860355")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 150
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  150000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 150000000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 860355),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    if(StormDataDT_recode_totals$REFNUM[[i]] == 867679)
    {
      #disposition
      #PROPDMG 100 PROPDMGEXP M recode_PROPDMGEXP 1000000 
      #PROPDMG.Total 100000000    Property.and.Crop.Damage 100000000
      print("REFNUM == 867679")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 100
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  100000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 100000000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 867679),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
    if(StormDataDT_recode_totals$REFNUM[[i]] == 867996)
    {
      #disposition
      #PROPDMG 200 PROPDMGEXP M recode_PROPDMGEXP 1000000 
      #PROPDMG.Total 200000000 #Property.and.Crop.Damage 200000000
      print("REFNUM == 867996")
      print(i)
      StormDataDT_recode_totals$PROPDMG[[i]] <- 200
      StormDataDT_recode_totals$PROPDMGEXP[[i]] <- "M"
      StormDataDT_recode_totals$recode_PROPDMGEXP[[i]] <- 1000000
      StormDataDT_recode_totals$PROPDMG.Total[[i]] <-  200000000
      StormDataDT_recode_totals$Property.and.Crop.Damage[[i]] <- 200000000
      print(select(filter(StormDataDT_recode_totals,REFNUM == 867996),
                   PROPDMG.Total:Property.and.Crop.Damage))
    }
  
  
}
```

### Filter data to keep only non-zero rows.

We load the data from the recodes into our working dataset, and then filter that dataset for non-zero values for the fields in our analysis.

```{r nonzero filter, cache = TRUE}
head(StormDataDT_recode_totals)
nrow(StormDataDT_recode_totals)
#[1] 902297
StormDataDT_recode <- StormDataDT_recode_totals[,
                          c("BGN_DATE_year","EVTYPE","FATALITIES","INJURIES",
                            "PROPDMG.Total","CROPDMG.Total",
                            "Fatalities.and.Injuries","Property.and.Crop.Damage")]
class(StormDataDT_recode)
head(StormDataDT_recode)

#check for zeroes
nrow(StormDataDT_recode[FATALITIES == 0  & INJURIES == 0])
nrow(StormDataDT_recode[Property.and.Crop.Damage == 0])
nrow(StormDataDT_recode[(FATALITIES == 0  & INJURIES == 0) | 
                          Property.and.Crop.Damage == 0])
nrow(StormDataDT_recode[!((FATALITIES == 0  & INJURIES == 0) | 
                          Property.and.Crop.Damage == 0)])
StormDataDT_recode_nonzero <- StormDataDT_recode[!(FATALITIES == 0  & INJURIES == 0 & 
                                                     Property.and.Crop.Damage == 0)]
nrow(StormDataDT_recode_nonzero)
```

The results in the nonzero skim of the data should be the same as they were in the working dataset that had all the zero value rows. Here are the sums for the working dataset.

```{r working dataset check for nonzero, cache = TRUE}
sum(StormDataDT_recode_totals$FATALITIES)
sum(StormDataDT_recode_totals$INJURIES)
sum(StormDataDT_recode_totals$Fatalities.and.Injuries)
sum(StormDataDT_recode_totals$PROPDMG.Total)
sum(StormDataDT_recode_totals$CROPDMG.Total)
sum(StormDataDT_recode_totals$Property.and.Crop.Damage)
```

Here are the sums for the filtered dataset.

```{r nonzero filter check, cache = TRUE}
sum(StormDataDT_recode_nonzero$FATALITIES)
sum(StormDataDT_recode_nonzero$INJURIES)
sum(StormDataDT_recode_nonzero$Fatalities.and.Injuries)
sum(StormDataDT_recode_nonzero$PROPDMG.Total)
sum(StormDataDT_recode_nonzero$CROPDMG.Total)
sum(StormDataDT_recode_nonzero$Property.and.Crop.Damage)
```

### Inflation Adjustment

We use the U.S. Inflation Calculator website [https://www.usinflationcalculator.com] to find out the value of 2011 dollars for the years 1950 to 2010. We insert this data into a table and join it with our data.

```{r infla table, cache = TRUE}
Inflation_multiplier <- tribble(
  ~year, ~Inflation.Adjustment,
  #----/----------------------
  1950	,	9.33	,
  1951	,	8.65	,
  1952	,	8.49	,
  1953	,	8.42	,
  1954	,	8.36	,
  1955	,	8.39	,
  1956	,	8.27	,
  1957	,	8	,
  1958	,	7.78	,
  1959	,	7.73	,
  1960	,	7.6	,
  1961	,	7.52	,
  1962	,	7.45	,
  1963	,	7.35	,
  1964	,	7.26	,
  1965	,	7.14	,
  1966	,	6.94	,
  1967	,	6.73	,
  1968	,	6.46	,
  1969	,	6.13	,
  1970	,	5.8	,
  1971	,	5.55	,
  1972	,	5.38	,
  1973	,	5.07	,
  1974	,	4.56	,
  1975	,	4.18	,
  1976	,	3.95	,
  1977	,	3.71	,
  1978	,	3.45	,
  1979	,	3.1	,
  1980	,	2.73	,
  1981	,	2.47	,
  1982	,	2.33	,
  1983	,	2.26	,
  1984	,	2.16	,
  1985	,	2.09	,
  1986	,	2.05	,
  1987	,	1.98	,
  1988	,	1.9	,
  1989	,	1.81	,
  1990	,	1.72	,
  1991	,	1.65	,
  1992	,	1.6	,
  1993	,	1.56	,
  1994	,	1.52	,
  1995	,	1.48	,
  1996	,	1.43	,
  1997	,	1.4	,
  1998	,	1.38	,
  1999	,	1.35	,
  2000	,	1.31	,
  2001	,	1.27	,
  2002	,	1.25	,
  2003	,	1.22	,
  2004	,	1.19	,
  2005	,	1.15	,
  2006	,	1.12	,
  2007	,	1.08	,
  2008	,	1.04	,
  2009	,	1.05	,
  2010	,	1.03	,
  2011	,	1	
)  
head(Inflation_multiplier)
tail(Inflation_multiplier)
StormDataDT_recode_nonzero <- as_tibble(StormDataDT_recode_nonzero)
StormDataDT_recode_nonzero <- 
  mutate(StormDataDT_recode_nonzero, year = as.numeric(BGN_DATE_year))

StormDataDT_recode_infla <- StormDataDT_recode_nonzero %>% 
  inner_join(Inflation_multiplier, by = "year")

names(StormDataDT_recode_infla)
head(StormDataDT_recode_infla$Inflation.Adjustment,100)
tail(StormDataDT_recode_infla$Inflation.Adjustment,100)
StormDataDT_recode_infla <- select(StormDataDT_recode_infla, -(BGN_DATE_year))
StormDataDT_recode_infla_adjusted <- transmute(StormDataDT_recode_infla, year,
          EVTYPE, FATALITIES, INJURIES, Fatalities.and.Injuries,
          PROPDMG.Total.Infla = PROPDMG.Total * Inflation.Adjustment,
          CROPDMG.Total.Infla = CROPDMG.Total * Inflation.Adjustment, 
          Property.and.Crop.Damage.Infla = Property.and.Crop.Damage * Inflation.Adjustment)
```

We check the inflation adjusted dataset.

```{r infla table check, cache = TRUE}
head(StormDataDT_recode_infla_adjusted)
tail(StormDataDT_recode_infla_adjusted)
nrow(StormDataDT_recode_infla_adjusted)
```

## EVTYPE recode

We group the EVTYPE desriptions into eight categories:

- DROUGHT, EXCESSIVE HEAT
- HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES
- HURRICANE SEASON
- THUNDERSTORM
- TORNADO, HAIL, HIGH WIND
- WILDFIRE
- WINTER WEATHER
- OTHER (e.g.: Tsunamis, rip currents, fog)

First, we sum by year and EVTYPE to recode a given EVTYPE in the smallest possible number of instances. We place that dataset in test copy that we will eventually use as our final copy. 

```{r EVTYPE recode setup, cache = TRUE}
StormDataDT_recode_summed <- 
  StormDataDT_recode_infla_adjusted %>% group_by(year, EVTYPE) %>% 
  summarize(Property.and.Crop.Damage.Sum = sum(Property.and.Crop.Damage.Infla),
            Fatalities.and.Injuries.Sum = sum(Fatalities.and.Injuries))
head(StormDataDT_recode_summed)
nrow(StormDataDT_recode_summed)
StormDataDT_recode_summed_test <- StormDataDT_recode_summed
class(StormDataDT_recode_summed_test)
```

Here is the code.

```{r EVTYPE recode, cache = TRUE}
for (i in 1:nrow(StormDataDT_recode_summed_test)) {
  
  if (StormDataDT_recode_summed_test$EVTYPE[[i]] =="DROUGHT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="DROUGHT/EXCESSIVE HEAT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="EXCESSIVE HEAT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAT WAVE" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAT WAVE DROUGHT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAT WAVES" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="RECORD HEAT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="RECORD/EXCESSIVE HEAT" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="UNSEASONABLY WARM" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="UNSEASONABLY WARM AND DRY" | 
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="WARM WEATHER" |
      #straggler
      StormDataDT_recode_summed_test$EVTYPE[[i]] =="Heat Wave" ) 
  
  {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "DROUGHT, EXCESSIVE HEAT"}
  
  if(StormDataDT_recode_summed_test$EVTYPE[[i]] =="   HIGH SURF ADVISORY" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] ==" FLASH FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="BREAKUP FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL  FLOODING/EROSION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL EROSION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL FLOODING/EROSION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTAL SURGE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="COASTALSTORM" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Coastal Flood" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Coastal Flooding" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Coastal Storm" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Erosion/Cstl Flood" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="EXCESSIVE RAINFALL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="EXCESSIVE SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="EXTREME HEAT" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD - HEAVY RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD LANDSLIDES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD/" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD/ STREET" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD/FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOOD/LANDSLIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOODING/FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLASH FLOODS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD & HEAVY RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD FLASH" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/FLASH" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/FLASH FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/FLASH/FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/FLASHFLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/RAIN/WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOOD/RIVER FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOODING/HEAVY RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="FLOODS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HAZARDOUS SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN AND FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Heavy Rain/High Surf" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN/LIGHTNING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN/SEVERE WEATHER" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN/SMALL STREAM URBAN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAIN/SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAINS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY RAINS/FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SEAS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SHOWER" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Heavy surf and wind" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SURF COASTAL FLOODING" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SURF/HIGH SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HEAVY SWELLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH  WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH SEAS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH SWELLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH TIDES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH WATER" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HIGH WAVES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="HVY RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LAKE FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LAKE-EFFECT SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LAKESHORE FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LANDSLIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LANDSLIDES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Landslump" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="LANDSPOUT" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MAJOR FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MARINE HIGH WIND" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MARINE STRONG WIND" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MINOR FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MIXED PRECIP" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Mixed Precipitation" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MUD SLIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MUD SLIDES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MUD SLIDES URBAN FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MUDSLIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="MUDSLIDES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RAIN/SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RAIN/WIND" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RAINSTORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RAPIDLY RISING WATER" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RECORD RAINFALL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RIP CURRENTS/HEAVY SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RIVER AND STREAM FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RIVER FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RIVER FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="ROCK SLIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="ROGUE WAVE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="ROUGH SEAS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="ROUGH SURF" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="RURAL FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="SMALL STREAM FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="STORM FORCE WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="STORM SURGE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="STORM SURGE/TIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TIDAL FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TORNADO F0" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TORNADO F1" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TORNADO F2" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TORNADO F3" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="TORNADOES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="Torrential Rainfall" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="UNSEASONAL RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN AND SMALL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN AND SMALL STREAM FLOODIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN FLOODS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN SMALL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN/SMALL STREAM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN/SMALL STREAM FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="URBAN/SML STREAM FLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="WIND AND WAVE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="WIND STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="WIND/HAIL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] =="WINDS" )
  
  {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES"}
  
  if(StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Hurricane Edouard" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE EMILY" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE ERIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE FELIX" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE GORDON" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE OPAL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE OPAL/HIGH WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE/TYPHOON" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HURRICANE-GENERATED SWELLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL DEPRESSION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL STORM ALBERTO" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL STORM DEAN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL STORM GORDON" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TROPICAL STORM JERRY" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TYPHOON" ) 
  
  {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "HURRICANE SEASON"}

  if(StormDataDT_recode_summed_test$EVTYPE[[i]] == "?" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "APACHE COUNTY" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ASTRONOMICAL HIGH TIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ASTRONOMICAL LOW TIDE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Beach Erosion" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COOL AND WET" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DAM BREAK" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DENSE FOG" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DENSE SMOKE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DOWNBURST" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DROWNING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FOG" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FOG AND COLD TEMPERATURES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY MIX" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY PRECIPITATION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HYPERTHERMIA/EXPOSURE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HYPOTHERMIA" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Hypothermia/Exposure" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Marine Accident" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "MARINE MISHAP" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Other" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "RIP CURRENT" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "RIP CURRENTS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "VOLCANIC ASH" |
     #stragglers
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HYPOTHERMIA/EXPOSURE" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "MIXED PRECIPITATION" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSUNAMI") 

  {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "OTHER"}
  
    if(StormDataDT_recode_summed_test$EVTYPE[[i]] == " TSTM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == " TSTM WIND (G45)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "FLASH FLOODING/THUNDERSTORM WI" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING  WAUSEON" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING AND HEAVY RAIN" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING AND THUNDERSTORM WIN" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING FIRE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING INJURY" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING THUNDERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING." | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHTNING/HEAVY RAIN" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGNTNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "MARINE THUNDERSTORM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "MARINE TSTM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SEVERE THUNDERSTORM" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SEVERE THUNDERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SEVERE THUNDERSTORMS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUDERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDEERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERESTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSNOW" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM  WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM DAMAGE TO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND (G40)" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND 60 MPH" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND 65 MPH" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND 65MPH" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND 98 MPH" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND G50" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND G52" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND G55" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND G60" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND TREES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND." | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND/ TREE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND/ TREES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND/AWNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND/HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WIND/LIGHTNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS 13" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS 63 MPH" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS AND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS G60" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS LIGHTNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS." | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS/ FLOOD" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS/FLOODING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS/FUNNEL CLOU" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS/HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDS53" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDSHAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINDSS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORM WINS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORMS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORMS WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORMS WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORMW" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTORMWINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERSTROM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNDERTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "THUNERSTORM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND  (G45)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND (41)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND (G35)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND (G40)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND (G45)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND 40" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND 45" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND 55" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND 65)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND AND LIGHTNING" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND DAMAGE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND G45" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND G58" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WIND/HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTM WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TSTMW" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TUNDERSTORM WIND" |
       #straggler
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Tstm Wind")
  
    {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "THUNDERSTORM"}
  
    if(StormDataDT_recode_summed_test$EVTYPE[[i]] == "DRY MICROBURST" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "DRY MIRCOBURST WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "DUST DEVIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "DUST DEVIL WATERSPOUT" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "DUST STORM" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "DUST STORM/HIGH WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "FUNNEL CLOUD" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GRADIENT WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GUSTNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GUSTY WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GUSTY WIND/HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GUSTY WIND/HVY RAIN" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Gusty wind/rain" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GUSTY WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 0.75" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 075" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 100" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 125" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 150" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 175" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 200" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 275" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 450" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL 75" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL DAMAGE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL/WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAIL/WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HAILSTORM" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND (G40)" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND 48" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND AND SEAS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND DAMAGE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND/BLIZZARD" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND/HEAVY SNOW" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WIND/SEAS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS HEAVY RAINS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS/" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS/COASTAL FLOOD" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS/COLD" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS/HEAVY RAIN" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "HIGH WINDS/SNOW" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "MARINE HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "MICROBURST" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "MICROBURST WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "NON TSTM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "NON-SEVERE WIND DAMAGE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "NON-TSTM WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SEICHE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SEVERE TURBULENCE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "SMALL HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "STRONG WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "STRONG WINDS" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TORNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TORNADOES, TSTM WIND, HAIL" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "TORNDAO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT-" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT TORNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT/ TORNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT/TORNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WATERSPOUT-TORNADO" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WET MICROBURST" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Whirlwind" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WIND" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WIND DAMAGE" |
       #stragglers 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Dust Devil" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "gradient wind" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Gusty winds" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Microburst" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Strong Wind" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Strong Winds" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WHIRLWIND" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Wind" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Wind Damage" |
       #stargglers
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Heavy Surf" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "High Surf" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Mudslide" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Mudslides" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "River Flooding" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Tidal Flooding" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Gradient wind" |
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "Gusty Winds" )
    
    {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "TORNADO, HAIL, HIGH WIND"}
  
    if(StormDataDT_recode_summed_test$EVTYPE[[i]] == "BRUSH FIRE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "FOREST FIRES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "GRASS FIRES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WILD FIRES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WILD/FOREST FIRE" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WILD/FOREST FIRES" | 
       StormDataDT_recode_summed_test$EVTYPE[[i]] == "WILDFIRES" )

    {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "WILDFIRE"} 
  
  if(StormDataDT_recode_summed_test$EVTYPE[[i]] == "AGRICULTURAL FREEZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "AVALANCE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "AVALANCHE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "BLACK ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "BLIZZARD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "BLIZZARD/WINTER STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "BLOWING DUST" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "BLOWING SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "blowing snow" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD AIR TORNADO" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD AND SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD AND WET CONDITIONS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Cold Temperature" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD WAVE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD WEATHER" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD/WIND CHILL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "COLD/WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "DAMAGING FREEZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Early Frost" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "EXCESSIVE WETNESS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Extended Cold" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "EXTREME COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "EXTREME COLD/WIND CHILL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "EXTREME WIND CHILL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "EXTREME WINDCHILL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FALLING SNOW/ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FLASH FLOOD FROM ICE JAMS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZING DRIZZLE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZING FOG" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZING RAIN/SLEET" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FREEZING RAIN/SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Freezing Spray" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FROST" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Frost/Freeze" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "FROST/FREEZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "GLAZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "GLAZE ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "GLAZE/ICE STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "GROUND BLIZZARD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HARD FREEZE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY LAKE SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW AND HIGH WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW AND STRONG WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Heavy snow shower" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW SQUALLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/BLIZZARD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/BLIZZARD/AVALANCHE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/HIGH WINDS & FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/SQUALLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/WIND" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW/WINTER STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOWPACK" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "HEAVY SNOW-SQUALLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE AND SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE FLOES" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE JAM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Ice jam flood (minor" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE JAM FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE ON ROAD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE ROADS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE STORM" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE STORM/FLASH FLOOD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICE/STRONG WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "ICY ROADS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Lake Effect Snow" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "LATE SEASON SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHT FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Light snow" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Light Snowfall" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "LOW TEMPERATURE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "RECORD COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "RECORD SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SLEET" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SLEET/ICE STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW ACCUMULATION" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW AND HEAVY SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW AND ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW AND ICE STORM" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW SQUALL" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW SQUALLS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/ BITTER COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/ ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/BLOWING SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/HEAVY SNOW" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/HIGH WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/ICE" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/ICE STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/SLEET" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOW/SLEET/FREEZING RAIN" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "SNOWMELT FLOODING" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Unseasonable Cold" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "UNSEASONABLY COLD" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTER STORM" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTER STORM HIGH WINDS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTER STORMS" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTER WEATHER MIX" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTER WEATHER/MIX" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Wintry Mix" |
     #stragglers
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Cold" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Damaging Freeze" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Extreme Cold" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Freeze" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Freezing Drizzle" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Freezing Rain" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Glaze" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "LAKE EFFECT SNOW" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Light Snow" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Snow" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Snow Squalls" | 
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "WINTRY MIX" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "Freezing drizzle" |
     StormDataDT_recode_summed_test$EVTYPE[[i]] == "LIGHT SNOW" )

   {StormDataDT_recode_summed_test$EVTYPE[[i]] <- "WINTER WEATHER"}   

}  
```

We are finally ready to compile the dataset we can use to show our results. 

```{r final data, cache = TRUE}
StormDataDT_recode_summed_final <- 
  StormDataDT_recode_summed_test %>% group_by(year, EVTYPE) %>%
  summarize(Property.and.Crop.Damage.Final = (sum(Property.and.Crop.Damage.Sum)/1000000),
          Fatalities.and.Injuries.Final = sum(Fatalities.and.Injuries.Sum))
```

## Results

The eight categories of natural disaster in our analysis are:

- DROUGHT, EXCESSIVE HEAT
- HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES
- HURRICANE SEASON
- THUNDERSTORM
- TORNADO, HAIL, HIGH WIND
- WILDFIRE
- WINTER WEATHER
- OTHER (e.g.: Tsunamis, rip currents, fog)

The years reported for the eight categories of natural disasters vary for all effects (property damage, crop damage, fatalities, and injurues). The TORNADO, HAIL, HIGH WIND category has data for the complete time period of this analysis (1950-2011). Fatalities and Injuries are reported for 1983-2011 for the THUNDERSTORM category. For the other six categories, and for the the THUNDERSTORM category for property damage and crop damage. 

The total costs for property and crop damage, knowing that all categories are not fully reported for the 1950-2011 time period, after inflation adjustment and recoding of a handul of the largest outliers for property and crop damage is $495.7 billion dollars. The total number of fatalities and injuries for this time period is 155,673, with 15,145 (9.7 percent) consisting fatalities, and 140,528 (90.3 percent) consisting of injuries.

```{r final sums, cache = TRUE}
sum(StormDataDT_recode_summed_final$Property.and.Crop.Damage.Final)
sum(StormDataDT_recode_infla_adjusted$FATALITIES)
sum(StormDataDT_recode_infla_adjusted$INJURIES)
sum(StormDataDT_recode_infla_adjusted$Fatalities.and.Injuries)
sum(StormDataDT_recode_infla_adjusted$FATALITIES)/sum(StormDataDT_recode_infla_adjusted$Fatalities.and.Injuries)
sum(StormDataDT_recode_infla_adjusted$INJURIES)/sum(StormDataDT_recode_infla_adjusted$Fatalities.and.Injuries)

```

Knowning that the categories are not comparable means that all we can say about the data when we consider all of the data are the total costs to property and crops and the total fatalities and injuries. 

With this caveat, for what has been reported between 1950 and 2011, "TORNADO, HAIL, HIGH WIND" events have cost	$172.9 billion dollars in property and crop damage, followed by 
"HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES"	property and crop damage costs at $139.6 billion dollars, and "HURRICANE SEASON"	property and crop damage costs at $119.6 billion dollars. The next categories accounted for relatively lower costs ($20 billion dollars and lower) each.

Again, with the caveat of incompletely reported data, for what has been reported between 1950 and 2011, "TORNADO, HAIL, HIGH WIND" events have cost	101,337 fatalities and injuries, or 65.1 percent of all reported fatalities and injuries in this dataset. All of the other categories represent much smaller fractions of this total, yet the data is unevenly reported.

```{r final table, cache = TRUE}
property_crop_damage_years <- StormDataDT_recode_summed_final %>% group_by(EVTYPE) %>% 
  summarize(Property.and.Crop.Damage.Years = sum(Property.and.Crop.Damage.Final)) %>% 
  arrange(desc(Property.and.Crop.Damage.Years)) 
kable(property_crop_damage_years)
fatalities_injuries_years <- StormDataDT_recode_summed_final %>% group_by(EVTYPE) %>% 
  summarize(Fatalities.and.Injuries.Years = sum(Fatalities.and.Injuries.Final)) %>%
  arrange(desc(Fatalities.and.Injuries.Years))
kable(fatalities_injuries_years)

```

Here is a plot of the otal Property and Crop Damage Caused by Natural Disasters for 1950-2011 for TORNADO, and for 1993-2011 for the other sever categories. The geograhical span of the data includes all U.S. states and territories (Puerto Rico, for example). The values are in $US Millions, and have been adjusted for inflation as 2011 dollars.

```{r final-data-plot-property, cache = TRUE, fig.height = 7, fig.width = 12}
ggplot(data = StormDataDT_recode_summed_final) +
  geom_col(mapping = aes(x = year, y = Property.and.Crop.Damage.Final)) + 
  facet_wrap(~ EVTYPE, nrow = 2) +
  ggtitle("Total Property and Crop Damage Caused by Natural Disasters (Source: NOAA)", 
          subtitle = "1950-2011 For TORNADO..., 1993-2011 for other Categories, 
          \n United States and Territories, In $US Millions, Inflation Adjusted (2011 Dollars)") +
  ylab("Total Property and Crop Damage")
```

Here is a plot of the total fatalities and injuries caused by the eight categories of natural disaster in this analysis. The data has bee reported for 1950-2011 for TORNADO..., 1983-2011 for THUNDERSTORMS, and 1993-2011 for other seven categories

```{r final-data-plot-people, cache = TRUE, fig.height = 7, fig.width = 12}
ggplot(data = StormDataDT_recode_summed_final) +
  geom_col(mapping = aes(x = year, y = Fatalities.and.Injuries.Final)) + 
  facet_wrap(~ EVTYPE, nrow = 2) +
  ggtitle("Total Fatalities and Injuries Caused by Natural Disasters (Source: NOAA)", 
          subtitle = "1950-2011 For TORNADO..., 1983-2011 for THUNDERSTORMS, 1993-2011 for other Categories, 
          \n United States and Territories") +
  ylab("Total Fatalities and Injuries")
```

The comparable data range for the data in this analysis is the time period 1993-2011. The totals for this time range are shown below. The top two categories for property and crop damage costs are close: HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES at	$139.6 billion dollars, and 
HURRICANE SEASON at	$119.6 billion dollars. The third category has also been financially costly, TORNADO, HAIL, HIGH WIND, at $62.2 billion dollars. 

For fatalities and injuries, though, the TORNADO, HAIL, HIGH WIND, at 28,883 has cost more than twice the total number of fatalities and injuries than the nearly equally costly three next categories: THUNDERSTORM at 12734 fatalities and injuries, DROUGHT, EXCESSIVE HEAT at 12174 fatalities and injuries, and HEAVY RAIN, FLOODING, MUDSLIDES, LANDSLIDES at 11566 fatalities and injuries.

```{r final table 1993, cache = TRUE}
StormDataDT_recode_since1993_final <- filter(StormDataDT_recode_summed_final, year >= 1993)
property_crop_damage_years_since1993 <- StormDataDT_recode_since1993_final %>% group_by(EVTYPE) %>% 
  summarize(Property.and.Crop.Damage.Years = sum(Property.and.Crop.Damage.Final)) %>% 
  arrange(desc(Property.and.Crop.Damage.Years)) 
kable(property_crop_damage_years_since1993)
fatalities_injuries_years <- StormDataDT_recode_since1993_final %>% group_by(EVTYPE) %>% 
  summarize(Fatalities.and.Injuries.Years = sum(Fatalities.and.Injuries.Final)) %>%
  arrange(desc(Fatalities.and.Injuries.Years))
kable(fatalities_injuries_years)

```

And finally, here is the range 1993-2011 for all categories, for property and crop damage. Hurricane Katrina and major floods in the Midwest figure prominently in this cost data. 

```{r final-data-plot-property-since1993, cache = TRUE, fig.height = 7, fig.width = 12}
ggplot(data = StormDataDT_recode_since1993_final) +
  geom_col(mapping = aes(x = year, y = Property.and.Crop.Damage.Final)) + 
  facet_wrap(~ EVTYPE, nrow = 2) +
  ggtitle("Total Property and Crop Damage Caused by Natural Disasters (Source: NOAA)", 
          subtitle = "1950-2011 For TORNADO..., 1993-2011 for other Categories, 
          \n United States and Territories, In $US Millions, Inflation Adjusted (2011 Dollars)") +
  ylab("Total Property and Crop Damage")
```

